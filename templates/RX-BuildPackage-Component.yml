spec:
  inputs:
    stage:
      default: RX-BuildPackage
    rules:
      default: '"true" == "true"'
---
RX-BuildPackage-Component:
  stage: $[[ inputs.stage ]]
  rules: 
    - if: $[[ inputs.rules ]]
  script:
    # Check or create Project Folder
    - if ( Test-Path $PackageProjectPath ) { echo "PackageProjectPath folder founded" } else { mkdir $PackageProjectPath; echo "PackageProjectPath folder created" }
    # Clear old package and xml
    - Get-ChildItem $PackageProjectPath | Remove-Item -Recurse -Force
    # Generate Package.xml
    - if ($BuildMode -eq "Release") { Start-Process -FilePath "$AutoGenPackageUtilPath\PackageXmlGenerator.exe" -ArgumentList "$GitProjectFolder $PackageProjectPath null true false" -Wait } else {echo "not Release" }
    - if ($BuildMode -eq "DebugRelease") { Start-Process -FilePath "$AutoGenPackageUtilPath\PackageXmlGenerator.exe" -ArgumentList "$GitProjectFolder $PackageProjectPath" -Wait } else {echo "not DebugRelease" }
    - if ($BuildMode -eq "Source") { Start-Process -FilePath "$AutoGenPackageUtilPath\PackageXmlGenerator.exe" -ArgumentList "$GitProjectFolder $PackageProjectPath null true true true" -Wait } else {echo "not Source" }
    - if ($BuildMode -eq "SourceBase") { Start-Process -FilePath "$AutoGenPackageUtilPath\PackageXmlGenerator.exe" -ArgumentList "$GitProjectFolder $PackageProjectPath null true true true true" -Wait } else {echo "not SourceBase" }
    - if ($BuildMode -eq "OnlySourceBase") { Start-Process -FilePath "$AutoGenPackageUtilPath\PackageXmlGenerator.exe" -ArgumentList "$GitProjectFolder $PackageProjectPath null false false true true" -Wait } else {echo "not OnlySourceBase" }
    - if ( Test-Path $PackageProjectPath\packageGen.xml ) { } else { echo "Not created packageGen.xml"; exit 1}
    # Build
    - $process = Start-Process -FilePath "$DDSConfigPath\DevelopmentStudio.exe" -ArgumentList "-c $PackageProjectPath\packageGen.xml -d $PackageProjectPath\package.dat --increment-version false" -PassThru
    - $process.WaitForExit()
    - if ( Test-Path $PackageProjectPath\package.dat ) { } else { echo "Not created package.dat"; exit 1}